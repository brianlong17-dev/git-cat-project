<!DOCTYPE html>
<html>

<head>
    <title>Cat Petting Olympics</title>
    <style>
        body {
            text-align: center;
            font-family: 'helvetica', cursive;
            background: #270a6c;
            color: rgb(172, 140, 224);
            padding-top: 50px;
        }

        #total-count {
            font-weight: bold;
            /* Make it bold */
            display: inline-block;
            /* Required for transform animations to work */
            transition: transform 0.1s;
        }

        /* This is the animation recipe */
        @keyframes heart-pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
                color: #ff1744;
            }

            /* Grow and turn bright red */
            100% {
                transform: scale(1);
            }
        }

        /* This class will be added/removed by JavaScript */
        .pulse-animation {
            animation: heart-pulse 0.3s ease-out;
        }

        #pet {
            font-size: 100px;
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-block;
            user-select: none;
            /* Prevents highlighting */
        }

        #pet:active {
            transform: scale(1.2);
        }

        .heart {
            color: red;
            /*Old browsers will possibly show black heart text Red heart */
            position: absolute;
            animation: float 2s ease-in forwards;
            user-select: none;
            /* Prevents highlighting */
            pointer-events: none;
            /* The "Ghost" property */
        }

        h1 {
            text-shadow: 2px 2px #ffffff;
            /* Adds a white glow behind your title */
        }

        .gold-heart {
            filter: drop-shadow(0 0 10px gold);
            /* This makes the emoji glow gold and shifts the red color to yellow */
            font-weight: bold;
        }

        @keyframes float {
            to {
                transform: translateY(-200px) translateX(var(--random-x)) rotate(-20deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <audio id="meow-sound" src="/static/meow.mp3"></audio>
    <h1>Pet Mr. Pussycat!</h1>
    <div id="pet">üê±</div>
    <p id="message">Click the cat to give it love.</p>
    <p>Love count: <span id="total-count">0</span></p>

    <script>
        let clickCount = 0;
        const pet = document.getElementById('pet');
        const msg = document.getElementById('message');
        const counterElement = document.getElementById('total-count');
        const updateDisplay = (count) => {
            counterElement.innerText = "‚ù§Ô∏èx" + count;
            // Trigger the pulse!
            counterElement.classList.remove('pulse-animation'); // Reset if it's already there
            void counterElement.offsetWidth; // This is a "magic" line to force a reset
            counterElement.classList.add('pulse-animation');
        };

        const heartLogic = (count, clickEvent) => {
            const heart = document.createElement('span');
            heart.classList.add('heart');
            if (count % 10 === 0) {
                heart.innerText = 'üíñ'; // Special heart for every 10th click
                heart.classList.add('gold-heart');
            } else {
                heart.innerText = '‚ù§Ô∏è';
            }

            const randomX = Math.floor(Math.random() * 101) - 50;
            heart.style.setProperty('--random-x', randomX + 'px');
            /*heart.className = 'heart';*/
            heart.style.left = clickEvent.pageX + 'px';
            heart.style.top = clickEvent.pageY + 'px';
            document.body.appendChild(heart);
            // Remove heart after animation finishes
            setTimeout(() => heart.remove(), 2000);
        };

        window.onload = () => {
            // Initialize the total count on page load
            fetch('/initial_pet')
                .then(response => response.json())
                .then(data => {
                    updateDisplay(data.total_pets); // Call the helper!
                });
        };
        pet.onclick = (event) => {
            clickCount++; // Increase our counter by 1
            // Check if clickCount is divisible by 3 (remainder is 0)
            if (clickCount % 3 === 0) {
                const audio = document.getElementById('meow-sound');
                audio.currentTime = 0;
                audio.play();
            }

            fetch('/pet_cat')
                .then(response => response.json())
                .then(data => {
                    msg.innerText = "The Cat's name is: " + data.name;
                    updateDisplay(data.total_pets);
                    heartLogic(data.total_pets, event) // Call the helper!
                });

        };
    </script>
</body>

</html>